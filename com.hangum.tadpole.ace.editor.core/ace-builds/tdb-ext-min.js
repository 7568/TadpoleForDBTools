function stringStartsWith(e,t){return e.slice(0,t.length)==t}var editorService={RDBinitEditor:function(e,t,r,i,o,n,a,s,d,c){},MONGODBinitEditor:function(e,t,r,i,o,n,a){},changeEditorStyle:function(e,t,r,i,o){},setFocus:function(){},setTheme:function(e){},setFontSize:function(e){},setWrap:function(e,t){},saveData:function(){},setTabSize:function(e){},getAllText:function(){},getSelectedText:function(){},setSelectedText:function(){},insertText:function(e){},addText:function(e){},isBlockText:function(){},reNewText:function(e){},HELP_POPUP:"60",helpDialog:function(){},DIRTY_CHANGED:"1",CONTENT_ASSIST:"5",SAVE:"15",AUTO_SAVE:"16",EXECUTE_QUERY:"25",EXECUTE_ALL_QUERY:"26",EXECUTE_PLAN:"30",EXECUTE_FORMAT:"35",F4_DML_OPEN:"40",GENERATE_SELECT:"45"},isEdited=!1,varDelimiter=";",varEditorType="TABLES",default_keywordList=[],strLastContent,langTools=ace.require("ace/ext/language_tools"),editor=ace.edit("editor"),StatusBar=ace.require("ace/ext/statusbar").StatusBar,statusBar=new StatusBar(editor,document.getElementById("statusBar")),EditSession=ace.require("ace/edit_session").EditSession,UndoManager=ace.require("./undomanager").UndoManager;editor.resize(!0),editor.setShowPrintMargin(!0),editor.setHighlightActiveLine(!0),editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!1}),editorService.RDBinitEditor=function(e,t,r,i,o,n,a,s,d,c){varEditorType=t;var l=new EditSession(i);strLastContent=i;try{l.setUndoManager(new UndoManager),l.setMode(e),l.on("change",function(){if(!isEdited){try{AceEditorBrowserHandler(editorService.DIRTY_CHANGED)}catch(e){console.log(e)}isEdited=!0}}),default_keywordList=r}catch(u){console.log(u)}try{editor.setTheme("ace/theme/"+n),editor.setFontSize(a+"px"),editor.renderer.setShowGutter("true"===c)}catch(u){console.log(u)}try{var f="true"===s;l.setUseWrapMode(f),f&&l.setWrapLimitRange(d,d)}catch(u){console.log(u)}"true"==o&&autoSave(),editor.setSession(l),editor.focus()},autoSave=function(){var e=editorService.getAllText();if(strLastContent!=e)try{if(""!=e){AceEditorBrowserHandler(editorService.AUTO_SAVE,e);strLastContent=e}}catch(t){console.log(t)}window.setTimeout(autoSave,3e4)},editorService.MONGODBinitEditor=function(e,t,r,i,o,n,a){editorService.RDBinitEditor(e,"NONE","",t,"false",r,i,o,n,a)},editorService.changeEditorStyle=function(e,t,r,i,o){editor.setTheme("ace/theme/"+e),editor.setFontSize(t+"px"),editor.renderer.setShowGutter("true"===o);var n="true"===r;session.setUseWrapMode(n),n&&session.setWrapLimitRange(i,i),editor.setSession(session)},ace.define("DynHighlightRules",[],function(e,t,r){var i=e("ace/lib/oop"),o=e("ace/mode/text_highlight_rules").TextHighlightRules,n=function(){this.setKeywords=function(e){this.keywordRule.onMatch=this.createKeywordMapper(e,"identifier")},this.keywordRule={regex:"\\w+",onMatch:function(){return"text"}},this.$rules={start:[{token:"string",start:'"',end:'"',next:[{token:"constant.language.escape.lsl",regex:/\\[tn"\\]/}]},this.keywordRule]},this.normalizeRules()};i.inherits(n,o),t.DynHighlightRules=n}),editorService.saveData=function(){isEdited=!1},editorService.setFocus=function(){editor.focus()};var shortcutErrMsg='Oops, an execution error has occured!\nEither click the "SQL" button of the tool bar, or open a new editor window.';editor.commands.on("afterExec",function(e){"insertstring"==e.command.name&&/^[\\.\(.]$/.test(e.args)&&tdbContentAssist()}),editor.commands.addCommand({name:"contentassist",bindKey:{win:"Ctrl-Space",mac:"Ctrl-Space"},exec:function(e){tdbContentAssist()},readOnly:!1}),tdbContentAssist=function(){try{var e=caParsePartSQL(),t=AceEditorBrowserHandler(editorService.CONTENT_ASSIST,e[0],e[1]),r=[];if(""!=t)for(var i=t.split("||"),o=0;o<i.length;o++){var n=i[o].split("|");r.push({value:n[0],score:2,meta:n[1]})}for(var a=default_keywordList.split("|"),o=0;o<a.length;o++)r.push({value:a[o],score:0,meta:"Keyword"});editor.completers=[],editor.completers.push({getCompletions:function(e,t,i,o,n){n(null,r)}}),editor.execCommand("startAutocomplete")}catch(s){console.log(s)}},editor.commands.addCommand({name:"save",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:function(e){try{var t=AceEditorBrowserHandler(editorService.SAVE,editorService.getAllText());t&&editorService.saveData()}catch(r){console.log(r),alert(shortcutErrMsg)}},readOnly:!1}),editorService.isBlockText=function(){return""!=editor.getSelectedText()?!0:!1},editor.commands.addCommand({name:"executeQuery",bindKey:{win:"Ctrl-Enter",mac:"Command-Enter"},exec:function(e){try{var t=editorService.getSelectedText();AceEditorBrowserHandler(editorService.EXECUTE_QUERY,t,editorService.isBlockText())}catch(r){console.log(r),alert(shortcutErrMsg)}},readOnly:!1}),editor.commands.addCommand({name:"executeObjectViewer",bindKey:{win:"F4",mac:"F4"},exec:function(e){try{var t=e.getSelectedText();if(""!=t)AceEditorBrowserHandler(editorService.F4_DML_OPEN,t);else{var r=e.session.getLine(e.getCursorPosition().row);if(""!=r){var i=parseCursorObject();AceEditorBrowserHandler(editorService.F4_DML_OPEN,i)}}}catch(o){console.log(o)}},readOnly:!1}),editor.commands.addCommand({name:"executeTableSelect",bindKey:{win:"Ctrl-I",mac:"Command-I"},exec:function(e){try{var t=e.getSelectedText();if(""!=t)AceEditorBrowserHandler(editorService.GENERATE_SELECT,t);else{var r=e.session.getLine(e.getCursorPosition().row);if(""!=r){var i=parseCursorObject();AceEditorBrowserHandler(editorService.GENERATE_SELECT,i)}}}catch(o){console.log(o)}},readOnly:!1}),parseCursorObject=function(){var e=editor.session.getLine(editor.getCursorPosition().row),t=e.substring(0,editor.getCursorPosition().column),r=t.split(" "),i=e.substring(editor.getCursorPosition().column),o=i.split(" "),n=r[r.length-1]+o[0];return n=n.replace(varDelimiter,"")},editor.commands.addCommand({name:"executePlan",bindKey:{win:"Ctrl-E",mac:"Command-E"},exec:function(e){try{AceEditorBrowserHandler(editorService.EXECUTE_PLAN,editorService.getSelectedText(";"),editorService.isBlockText())}catch(t){console.log(t),alert(shortcutErrMsg)}},readOnly:!1}),editor.commands.addCommand({name:"format",bindKey:{win:"Ctrl-Shift-F",mac:"Command-Shift-F"},exec:function(e){try{var t=AceEditorBrowserHandler(editorService.EXECUTE_FORMAT,editorService.getAllText());e.setValue(t)}catch(r){console.log(r),alert(shortcutErrMsg)}},readOnly:!1}),editor.commands.addCommand({name:"changeLowCase",bindKey:{win:"Ctrl-Shift-Y",mac:"Command-Shift-Y"},exec:function(e){e.toLowerCase()},readOnly:!1}),editor.commands.addCommand({name:"changeUpperCase",bindKey:{win:"Ctrl-Shift-X",mac:"Command-Shift-X"},exec:function(e){e.toUpperCase()},readOnly:!1}),editor.commands.addCommand({name:"helpDialog",bindKey:{win:"Ctrl-Shift-L",mac:"Command-Shift-L"},exec:function(e){try{editorService.helpDialog()}catch(t){console.log(t)}},readOnly:!1}),editor.commands.addCommand({name:"cleagePage",bindKey:{win:"Ctrl-F7",mac:"Command-F7"},exec:function(e){e.setValue("")},readOnly:!1}),editorService.setTabSize=function(e){editor.getSession().setTabSize(e)},editorService.getAllText=function(){return editor.getValue()},editorService.setSelectedText=function(){var e=editorService.getSelectedText(),t=editor.getCursorPosition().row;editor.gotoLine(t-1),editor.find(e)},editorService.getSelectedText=function(){var e=editor.getValue();if(""==e)return"";if("PROCEDURES"==varEditorType||"FUNCTIONS"==varEditorType||"TRIGGERS"==varEditorType){var t=editor.getSelectedText();return""!=t?t:e}try{var t=editor.getSelectedText();if(""!=t)return t;var r=parsePartSQL();return r[0]}catch(i){console.log(i)}},editorService.insertText=function(e){try{editor.insert(e),editor.focus()}catch(t){console.log(t)}},editorService.addText=function(e){try{""==editor.getValue()?editor.insert(e):(editor.gotoLine(editor.session.getLength()+1),editor.insert("\n"+e)),editor.focus()}catch(t){console.log(t)}},editorService.reNewText=function(e){editor.setValue(""),editor.insert(e)},editorService.helpDialog=function(){try{AceEditorBrowserHandler(editorService.HELP_POPUP)}catch(e){console.log(e)}},caParsePartSQL=function(){var e=editor.getCursorPosition(),t=findCursorSQL(e.row,e.column);return t},parsePartSQL=function(){var e=editor.getCursorPosition(),t=findCursorSQL(e.row,e.column);if(""==t[0].trim()){var r=findPreviousLineText(e.row);if(-1!==r){var i=editor.session.getLine(r);t=findCursorSQL(r,i.length)}}return t},findPreviousLineText=function(e){for(var t=-1;e>0;){for(var r=editor.session.getTokens(e).filter(function(e){return"text"===e.type}),i=0;i<r.length;i++)if(stringStartsWith(r[i].value,varDelimiter)){t=e;break}if(t>=0)break;e--}return t},findCursorSQL=function(e,t){for(var r=editor.session.getLength(),i=-1,o=-1,n=0,a=e-1;a>0;){for(var s=editor.session.getTokens(a).filter(function(e){return"text"===e.type}),d=0;d<s.length;d++)if(findDelimiterText(s[d].value)){i=a;break}if(i>=0)break;a--}for(-1==i&&(i=0),a=e;r>a;){for(var s=editor.session.getTokens(a).filter(function(e){return"text"===e.type}),d=0;d<s.length;d++)if(findDelimiterText(s[d].value)){o=a;break}if(o>=0)break;a++}-1==o&&(o=r);for(var c="",l=!1,u=editor.session.getTokens(i),d=0;d<u.length;d++){var f=u[d];"text"===f.type&&findDelimiterText(f.value)?l=!0:l&&(c+=f.value)}0==l&&""==c?c=editor.session.getLine(i)+"\n":1==l&&""==c&&(c="\n");for(var m="",g=i+1;o>g;g++)m+=editor.session.getLine(g)+"\n";for(var S="",u=editor.session.getTokens(o),d=0;d<u.length;d++){var f=u[d];if("text"===f.type&&findDelimiterText(f.value))break;S+=f.value}for(var v=c+m+S+" ",E=e-i,h=v.split("\n"),n=E,d=0;E>d;d++)n+=h[d].length;n+=t;var T=[];return T.push(v),T.push(n),T},findDelimiterText=function(e){return e.indexOf(varDelimiter)>-1?!0:!1};