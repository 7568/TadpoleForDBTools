var editorService={initEditor:function(varExt,varKeyword,varInitText){},setFocus:function(){},saveData:function(){},setTabSize:function(varTabSize){},getAllText:function(){},getSelectedText:function(varDelimiter){},insertText:function(varText){},addText:function(varText){},isBlockText:function(){},reNewText:function(varText){},HELP_POPUP:"60",helpDialog:function(){},DIRTY_CHANGED:"1",SAVE:"15",EXECUTE_QUERY:"25",EXECUTE_ALL_QUERY:"26",EXECUTE_PLAN:"30",EXECUTE_FORMAT:"35",F4_DML_OPEN:"40",GENERATE_SELECT:"45"};var editor;var isEdited=false;var varEditorType="TABLES";var langTools=ace.require("ace/ext/language_tools");editor=ace.edit("editor");document.getElementById("editor").style.fontSize="12px";var StatusBar=ace.require("ace/ext/statusbar").StatusBar;var statusBar=new StatusBar(editor,document.getElementById("statusBar"));editor.setTheme("ace/theme/eclipse");editor.setShowPrintMargin(true);editor.setHighlightActiveLine(true);editor.setOptions({enableBasicAutocompletion:true,enableSnippets:true,enableLiveAutocompletion:true});ace.define("DynHighlightRules",[],function(require,exports,module){var oop=require("ace/lib/oop");var TextHighlightRules=require("ace/mode/text_highlight_rules").TextHighlightRules;var DynHighlightRules=function(){this.setKeywords=function(kwMap){this.keywordRule.onMatch=this.createKeywordMapper(kwMap,"identifier");};this.keywordRule={regex:"\\w+",onMatch:function(){return"text";}};this.$rules={"start":[{token:"string",start:'"',end:'"',next:[{token:"constant.language.escape.lsl",regex:/\\[tn"\\]/}]},this.keywordRule]};this.normalizeRules();};oop.inherits(DynHighlightRules,TextHighlightRules);exports.DynHighlightRules=DynHighlightRules;});editorService.initEditor=function(varMode,varType,varTableList,varInitText){varEditorType=varType;try{var EditSession=ace.require("ace/edit_session").EditSession;var UndoManager=ace.require("./undomanager").UndoManager;var session=new EditSession(varInitText);session.setUndoManager(new UndoManager());session.setMode(varMode);session.on("change",function(){if(!isEdited){try{AceEditorBrowserHandler(editorService.DIRTY_CHANGED);}catch(e){console.log(e);}isEdited=true;}});var keywordList=session.$mode.$highlightRules.$keywordList;if(keywordList!=null){session.$mode.$highlightRules.$keywordList=keywordList.concat(varTableList.split("|"));}editor.setSession(session);editor.focus();}catch(e){console.log(e);}};editorService.saveData=function(){isEdited=false;};editorService.setFocus=function(){editor.focus();};var shortcutErrMsg='Oops, an execution error has occured!\nEither click the "SQL" button of the tool bar, or open a new editor window.';editor.commands.addCommand({name:"save",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:function(editor){try{var boolDoSave=AceEditorBrowserHandler(editorService.SAVE,editorService.getAllText());if(boolDoSave){editorService.saveData();}}catch(e){console.log(e);alert(shortcutErrMsg);}},readOnly:false});editorService.isBlockText=function(){var isBlock=false;if(""!=editor.getSelectedText()){isBlock=true;}return isBlock;};editor.commands.addCommand({name:"executeQuery",bindKey:{win:"Ctrl-Enter",mac:"Command-Enter"},exec:function(editor){try{AceEditorBrowserHandler(editorService.EXECUTE_QUERY,editorService.getSelectedText(";"),editorService.isBlockText());}catch(e){console.log(e);alert(shortcutErrMsg);}},readOnly:false});editor.commands.addCommand({name:"executeObjectViewer",bindKey:{win:"F4",mac:"F4"},exec:function(editor){try{var varSelectionContent=editor.getSelectedText();if(varSelectionContent!=""){AceEditorBrowserHandler(editorService.F4_DML_OPEN,varSelectionContent);}else{var startQueryLine=editor.session.getLine(editor.getCursorPosition().row);if(startQueryLine!=""){var strBeforeTxt=startQueryLine.substring(0,editor.getCursorPosition().column);var strArryBeforeTxt=strBeforeTxt.split(" ");var strAfterTxt=startQueryLine.substring(editor.getCursorPosition().column);var strArryAfterTxt=strAfterTxt.split(" ");var strTableName=strArryBeforeTxt[strArryBeforeTxt.length-1]+strArryAfterTxt[0];strTableName=strTableName.replace(";","");AceEditorBrowserHandler(editorService.F4_DML_OPEN,strTableName);}}}catch(e){console.log(e);}},readOnly:false});editor.commands.addCommand({name:"executeTableSelect",bindKey:{win:"Ctrl-I",mac:"Command-I"},exec:function(editor){try{var varSelectionContent=editor.getSelectedText();if(varSelectionContent!=""){AceEditorBrowserHandler(editorService.GENERATE_SELECT,varSelectionContent);}else{var startQueryLine=editor.session.getLine(editor.getCursorPosition().row);if(startQueryLine!=""){var strBeforeTxt=startQueryLine.substring(0,editor.getCursorPosition().column);var strArryBeforeTxt=strBeforeTxt.split(" ");var strAfterTxt=startQueryLine.substring(editor.getCursorPosition().column);var strArryAfterTxt=strAfterTxt.split(" ");var strTableName=strArryBeforeTxt[strArryBeforeTxt.length-1]+strArryAfterTxt[0];strTableName=strTableName.replace(";","");AceEditorBrowserHandler(editorService.GENERATE_SELECT,strTableName);}}}catch(e){console.log(e);}},readOnly:false});editor.commands.addCommand({name:"executePlan",bindKey:{win:"Ctrl-E",mac:"Command-E"},exec:function(editor){try{AceEditorBrowserHandler(editorService.EXECUTE_PLAN,editorService.getSelectedText(";"),editorService.isBlockText());}catch(e){console.log(e);alert(shortcutErrMsg);}},readOnly:false});editor.commands.addCommand({name:"format",bindKey:{win:"Ctrl-Shift-F",mac:"Command-Shift-F"},exec:function(editor){try{var varFormat=AceEditorBrowserHandler(editorService.EXECUTE_FORMAT,editorService.getAllText());editor.setValue(varFormat);}catch(e){console.log(e);alert(shortcutErrMsg);}},readOnly:false});editor.commands.addCommand({name:"changeLowCase",bindKey:{win:"Ctrl-Shift-Y",mac:"Command-Shift-Y"},exec:function(editor){editor.toLowerCase();},readOnly:false});editor.commands.addCommand({name:"changeUpperCase",bindKey:{win:"Ctrl-Shift-X",mac:"Command-Shift-X"},exec:function(editor){editor.toUpperCase();},readOnly:false});editor.commands.addCommand({name:"helpDialog",bindKey:{win:"Ctrl-Shift-L",mac:"Command-Shift-L"},exec:function(editor){try{editorService.helpDialog();}catch(e){console.log(e);}},readOnly:false});editor.commands.addCommand({name:"cleagePage",bindKey:{win:"Ctrl-F7",mac:"Command-F7"},exec:function(editor){editor.setValue("");},readOnly:false});editorService.setFont=function(varFontName,varFontSize){try{document.getElementById("editor").style.fontSize=varFontSize+"px";document.getElementById("editor").style.fontFamily=varFontName;}catch(e){console.log(e);}};editorService.setTabSize=function(varTabSize){editor.getSession().setTabSize(varTabSize);};editorService.getAllText=function(){return editor.getValue();};editorService.getSelectedText=function(varDelimiter){var varEditorContent=editor.getValue();if(""==varEditorContent){return"";}if(varEditorType=="PROCEDURES"||varEditorType=="FUNCTIONS"||varEditorType=="TRIGGERS"){var varSelectionContent=editor.getSelectedText();if(""!=varSelectionContent){return varSelectionContent;}else{return varEditorContent;}}try{var varSelectionContent=editor.getSelectedText();if(""!=varSelectionContent){return varSelectionContent;}else{var strReturnSQL="";var startQueryLine=editor.session.getLine(editor.getCursorPosition().row);if(startQueryLine.lastIndexOf(varDelimiter)!=-1){strReturnSQL=findPreviousChar((editor.getCursorPosition().row-1),varDelimiter);strReturnSQL+=startQueryLine.substring(0,startQueryLine.lastIndexOf(varDelimiter));}else{strReturnSQL=findPreviousChar((editor.getCursorPosition().row-1),varDelimiter);strReturnSQL+=startQueryLine+"\n";strReturnSQL+=findNextCharacter((editor.getCursorPosition().row+1),varDelimiter);}if(strReturnSQL.trim()==""){var intDelimiterLineNumber=findPreviousLineText(editor.getCursorPosition().row,varDelimiter);if(-1!==intDelimiterLineNumber){strReturnSQL=findPreviousChar(intDelimiterLineNumber-1,varDelimiter);startQueryLine=editor.session.getLine(intDelimiterLineNumber);strReturnSQL+=startQueryLine.substring(0,startQueryLine.lastIndexOf(varDelimiter));}}return strReturnSQL;}}catch(e){console.log(e);}};findPreviousLineText=function(varLineNum,varDelimiter){for(var i=varLineNum;i>=0;i--){var startQueryLine=editor.session.getLine(i);var lastIndexOf=startQueryLine.lastIndexOf(varDelimiter);if(lastIndexOf!=-1){return i;break;}}return -1;};findPreviousChar=function(varLineNum,varDelimiter){var strReturnQuery="";var arryPreQuery=new Array();var intArrayPostion=0;for(var i=varLineNum;i>=0;i--){var startQueryLine=editor.session.getLine(i);var lastIndexOf=startQueryLine.lastIndexOf(varDelimiter);if(lastIndexOf!=-1){arryPreQuery[intArrayPostion]=startQueryLine.substring(lastIndexOf+1);break;}else{arryPreQuery[intArrayPostion]=startQueryLine;}intArrayPostion++;}for(i=0;i<arryPreQuery.length;i++){strReturnQuery+=arryPreQuery[(arryPreQuery.length-i)-1]+"\n";}return strReturnQuery;};findNextCharacter=function(varLineNum,varDelimiter){var strReturnQuery="";var intRowCount=editor.session.getLength();var arryPreQuery=new Array();var intArrayPostion=0;for(var i=varLineNum;i<intRowCount;i++){var startQueryLine=editor.session.getLine(i);var lastIndexOf=startQueryLine.lastIndexOf(varDelimiter);if(lastIndexOf!=-1){arryPreQuery[intArrayPostion]=startQueryLine.substring(0,lastIndexOf+1);break;}else{arryPreQuery[intArrayPostion]=startQueryLine;}intArrayPostion++;}for(i=0;i<arryPreQuery.length;i++){strReturnQuery+=arryPreQuery[i]+"\n";}return strReturnQuery;};editorService.insertText=function(varText){try{editor.insert(varText);editor.focus();}catch(e){console.log(e);}};editorService.addText=function(varText){try{if(""==editor.getValue()){editor.insert(varText);}else{editor.gotoLine(editor.session.getLength()+1);editor.insert("\n"+varText);}editor.focus();}catch(e){console.log(e);}};editorService.reNewText=function(varText){editor.setValue(varText);};editorService.helpDialog=function(){try{AceEditorBrowserHandler(editorService.HELP_POPUP);}catch(e){console.log(e);}};